# Bank Customer Churn Prediction using Neural Network

import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import LabelEncoder, StandardScaler
from sklearn.metrics import confusion_matrix, accuracy_score
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import Dense

# ---------- Step 1: Read the Dataset ----------
df = pd.read_csv("Churn_Modelling.csv")  # Download from Kaggle

# ---------- Step 2: Features & Target ----------
X = df.iloc[:, 3:13]   # Features (exclude RowNumber, CustomerId, Surname)
y = df['Exited']       # Target variable (1 = Left, 0 = Stayed)

# Convert categorical columns to numeric
le_gender = LabelEncoder()
X['Gender'] = le_gender.fit_transform(X['Gender'])  # Male=1, Female=0
X = pd.get_dummies(X, columns=['Geography'], drop_first=True)

# Split data
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# ---------- Step 3: Normalize the Data ----------
sc = StandardScaler()
X_train = sc.fit_transform(X_train)
X_test = sc.transform(X_test)

# ---------- Step 4: Build the Neural Network ----------
model = Sequential()
model.add(Dense(units=6, activation='relu', input_dim=X_train.shape[1]))  # Hidden layer 1
model.add(Dense(units=6, activation='relu'))                              # Hidden layer 2
model.add(Dense(units=1, activation='sigmoid'))                           # Output layer

# Compile model
model.compile(optimizer='adam', loss='binary_crossentropy', metrics=['accuracy'])

# Train model
model.fit(X_train, y_train, batch_size=32, epochs=20, verbose=0)

# ---------- Step 5: Evaluate the Model ----------
y_pred = (model.predict(X_test) > 0.5)  # Convert probabilities to binary 0/1

acc = accuracy_score(y_test, y_pred)
cm = confusion_matrix(y_test, y_pred)

print("\nAccuracy:", round(acc, 3))
print("Confusion Matrix:\n", cm)
